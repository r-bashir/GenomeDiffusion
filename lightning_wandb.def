BootStrap: docker
From: nvcr.io/nvidia/pytorch:25.01-py3

%post
    echo "Installing additional dependencies..."
    
    # Ensure pip is up-to-date
    python3 -m pip install --upgrade pip

    # Install PyTorch Lightning and Weights & Biases
    python3 -m pip install --no-cache-dir pytorch-lightning wandb

    # Set up wandb API key in the container environment
    echo 'export WANDB_API_KEY="cd68c5a140d1346421e71ebad92df1921db1cc19"' >> /environment

%environment
    # Set up environment variables for PyTorch/NVIDIA
    export PATH=/opt/conda/bin:$PATH
    export PYTHONUNBUFFERED=1
    export WANDB_DIR=/workspace
    export WANDB_CACHE_DIR=/workspace/.wandb
    # The WANDB_API_KEY is set in the /environment file

%runscript
    echo "Container is ready! Run your PyTorch scripts with:"
    echo "python your_script.py"
